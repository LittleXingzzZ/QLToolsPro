import{N as e,r as a,k as t,w as l,f as i,a4 as o,a6 as r,c as s,u as n,a8 as p,L as d,a3 as m,i as u,F as c,J as f,a2 as v}from"./@vue-11129043.js";import{p as b}from"./p-center-modal-60835ea2.js";import"./dayjs-1ff0b700.js";import{a3 as j,ai as y,aj as x}from"./index-180795d1.js";import{al as h,S as g}from"./@ant-design-477981d5.js";import{m as _,F as I,E as C}from"./ant-design-vue-cc438dd6.js";import{_ as F}from"./page-container-6fc30811.js";import{d as S}from"./common-2c0ac4fc.js";import"./pinia-1ca0c29b.js";import"./vue-demi-a81ff0a7.js";import"./store-38971876.js";import"./_plugin-vue_export-helper-9b9a8a5b.js";import"./@babel-eab0ef53.js";import"./axios-93d3568f.js";import"./qs-8fb0a9f1.js";import"./side-channel-ee547e73.js";import"./get-intrinsic-53528089.js";import"./has-symbols-1f359e75.js";import"./function-bind-c930bb92.js";import"./has-03e8e28c.js";import"./call-bind-566c57e8.js";import"./object-inspect-5c6480f3.js";import"./vue-router-36397834.js";import"./vue3-colorpicker-e1559e09.js";import"./vue-types-0fd36d85.js";import"./is-plain-object-39134198.js";import"./tinycolor2-e232e212.js";import"./@vueuse-94329f85.js";import"./@aesoper-316802a3.js";import"./vue3-angle-2884cf46.js";import"./gradient-parser-c9367eab.js";import"./lodash-es-0ceb8576.js";import"./@popperjs-31624eb1.js";import"./resize-observer-polyfill-9cd09a67.js";import"./@ctrl-16df70a4.js";import"./dom-align-6a5270eb.js";import"./async-validator-604317c1.js";import"./scroll-into-view-if-needed-8ce8502d.js";import"./compute-scroll-into-view-cce79123.js";const U=d(" 上传 "),w=d("取消"),A=d("提交"),D={__name:"editOrAdd",props:{dataObj:Object,visible:Boolean},emits:["update:visible","updateData"],setup(d,{emit:u}){const c=d,{visible:f,dataObj:v}=e(c),y=a([{value:"ordinary",label:"普通"},{value:"cron",label:"定时"}]),x=()=>{u("update:visible",!1)},g=t({type:"ordinary",file:[]}),I={type:[{required:!0,trigger:"change"}],file:[{required:!0,trigger:"change",message:"请上传插件"}]},C=e=>{g.file=[]},F=e=>(g.file=[e],!1),S=e=>{},D=(...e)=>{},N={labelCol:{span:7},wrapperCol:{span:15}},O=e=>{let a={type:g.type},t=new FormData;t.append("file",g.file[0].originFileObj),j({splicingData:a,data:t}).then((()=>{_.success("操作成功"),u("updateData"),x()}))};l(f,((e,a,t)=>{f.value&&E()}));const E=()=>{g.type="ordinary",g.file=[]};return(e,a)=>{const t=m("a-select"),l=m("a-form-item"),d=m("a-button"),u=m("a-upload"),c=m("a-divider"),v=m("a-form");return i(),o(b,{modalVisible:n(f),isFooter:!1,onClose:x,title:"上传插件"},{content:r((()=>[s(v,p({ref:"formRef",name:"custom-validation",model:g,rules:I},N,{onValidate:D,onFinishFailed:S,onFinish:O}),{default:r((()=>[s(l,{label:"类型:",name:"type"},{default:r((()=>[s(t,{value:g.type,"onUpdate:value":a[0]||(a[0]=e=>g.type=e),placeholder:"请选择",style:{width:"200px"},options:y.value},null,8,["value","options"])])),_:1}),s(l,{label:"插件",name:"file"},{default:r((()=>[s(u,{fileList:g.file,"onUpdate:fileList":a[1]||(a[1]=e=>g.file=e),"max-count":1,onRemove:C,"before-upload":F},{default:r((()=>[s(d,null,{default:r((()=>[s(n(h)),U])),_:1})])),_:1},8,["fileList"])])),_:1}),s(c),s(l,{"wrapper-col":{span:12,offset:12},class:"timed-start-button"},{default:r((()=>[s(d,{onClick:x},{default:r((()=>[w])),_:1}),s(d,{type:"primary",style:{"margin-left":"20px"},"html-type":"submit"},{default:r((()=>[A])),_:1})])),_:1})])),_:1},16,["model"])])),_:1},8,["modalVisible"])}}},N=d(" 搜索 "),O=d(" 此操作会覆盖原有内容？ "),E=d("下载 "),k={__name:"index",setup(e){const l=a({}),p=a(!1),d=a({}),b=I.useForm,j=a(0),h=a(1),_=a(10);C.PRESENTED_IMAGE_SIMPLE;const U=t({type:"ordinary"});a(!1);const{resetFields:w,validate:A,validateInfos:k}=b(U),L=a([{value:"ordinary",label:"普通"},{value:"cron",label:"定时"},{value:"front",label:"前置"}]),z=[{title:"文件名称",dataIndex:"FileName"},{title:"插件名称",dataIndex:"Name"},{title:"版本",dataIndex:"Version"},{title:"上传人",dataIndex:"Author"},{title:"更新日期",dataIndex:"Time"},{title:"操作",dataIndex:"operation",customKey:"operation"}],V=[{title:"文件名称",dataIndex:"FileName"},{title:"插件名称",dataIndex:"Name"},{title:"插件执行变量名",dataIndex:"EnvName"},{title:"定时规则",dataIndex:"Cron"},{title:"版本",dataIndex:"Version"},{title:"上传人",dataIndex:"Author"},{title:"更新日期",dataIndex:"Time"},{title:"操作",dataIndex:"operation",customKey:"operation"}],T=a(z),q=a([]),K=e=>{e&&(h.value=1);let a={type:d.value.type};y({data:U,splicingData:a}).then((e=>{"cron"==d.value.type?T.value=V:T.value=z;try{j.value=(e.page||0)*_.value}catch(a){j.value=0}q.value=(e||[]).map((e=>(e.CreatedAt&&(e.CreatedAt=S(e.CreatedAt)),e.UpdatedAt&&(e.UpdatedAt=S(e.UpdatedAt)),e)))}))};return d.value=U,(e,a)=>{const t=m("a-select"),b=m("a-form-item"),y=m("a-button"),I=m("a-form"),C=m("a-popconfirm");return i(),u(c,null,[s(D,{visible:p.value,"onUpdate:visible":a[0]||(a[0]=e=>p.value=e),onUpdateData:a[1]||(a[1]=e=>K(!0)),dataObj:l.value},null,8,["visible","dataObj"]),s(F,{columns:T.value,pageSize:_.value,"onUpdate:pageSize":a[4]||(a[4]=e=>_.value=e),current:h.value,"onUpdate:current":a[5]||(a[5]=e=>h.value=e),total:j.value,"onUpdate:total":a[6]||(a[6]=e=>j.value=e),isTable:!0,isSearch:!0,onOnShowSizeChange:K,onInitData:K,dataSource:q.value},{search:r((()=>[s(I,{class:"flex flex-warp",model:U},{default:r((()=>[s(b,{label:"类型:",name:"type"},{default:r((()=>[s(t,{value:U.type,"onUpdate:value":a[2]||(a[2]=e=>U.type=e),placeholder:"请选择",style:{width:"200px"},options:L.value},null,8,["value","options"])])),_:1}),s(b,null,{default:r((()=>[s(y,{type:"primary",onClick:a[3]||(a[3]=f((e=>{A().then((e=>{d.value=U,K(!0)})).catch((e=>{}))}),["prevent"])),class:"filter-search"},{default:r((()=>[s(n(g)),N])),_:1})])),_:1})])),_:1},8,["model"])])),bodyCell:r((({text:e,record:a,index:t,column:l})=>["operation"===l.customKey?(i(),o(C,{key:0,placement:"topLeft","ok-text":"确认","cancel-text":"取消",onConfirm:e=>{return t=a,void x({data:{type:d.value.type,file_name:t.FileName}});var t}},{title:r((()=>[O])),default:r((()=>[s(y,{type:"primary",style:{"margin-left":"10px","margin-bottom":"10px"},shape:"round"},{default:r((()=>[E])),_:1})])),_:2},1032,["onConfirm"])):v("",!0)])),_:1},8,["columns","pageSize","current","total","dataSource"])],64)}}};export{k as default};
