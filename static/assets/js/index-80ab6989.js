import{_ as e}from"./page-container-6fc30811.js";import{p as a}from"./p-center-modal-60835ea2.js";import"./dayjs-1ff0b700.js";import{a8 as l,a9 as t,aa as o,ab as s,ac as i,ad as n,ae as r,af as p,ag as d,A as u,ah as c}from"./index-180795d1.js";import{N as f,k as m,w as v,f as b,a4 as h,a6 as _,c as j,u as g,a8 as y,L as x,a3 as w,r as k,i as C,F as U,_ as D}from"./@vue-11129043.js";import{al as A}from"./@ant-design-477981d5.js";import{m as B}from"./ant-design-vue-cc438dd6.js";import"./pinia-1ca0c29b.js";import"./vue-demi-a81ff0a7.js";import"./store-38971876.js";import"./_plugin-vue_export-helper-9b9a8a5b.js";import"./@babel-eab0ef53.js";import"./axios-93d3568f.js";import"./qs-8fb0a9f1.js";import"./side-channel-ee547e73.js";import"./get-intrinsic-53528089.js";import"./has-symbols-1f359e75.js";import"./function-bind-c930bb92.js";import"./has-03e8e28c.js";import"./call-bind-566c57e8.js";import"./object-inspect-5c6480f3.js";import"./vue-router-36397834.js";import"./vue3-colorpicker-e1559e09.js";import"./vue-types-0fd36d85.js";import"./is-plain-object-39134198.js";import"./tinycolor2-e232e212.js";import"./@vueuse-94329f85.js";import"./@aesoper-316802a3.js";import"./vue3-angle-2884cf46.js";import"./gradient-parser-c9367eab.js";import"./lodash-es-0ceb8576.js";import"./@popperjs-31624eb1.js";import"./resize-observer-polyfill-9cd09a67.js";import"./@ctrl-16df70a4.js";import"./dom-align-6a5270eb.js";import"./async-validator-604317c1.js";import"./scroll-into-view-if-needed-8ce8502d.js";import"./compute-scroll-into-view-cce79123.js";const O=x(" 上传 "),F=x("取消"),I=x("提交"),L={__name:"restorePop",props:{dataObj:Object,visible:Boolean},emits:["update:visible","updateData"],setup(e,{emit:t}){const o=e,{visible:s,dataObj:i}=f(o),n=()=>{t("update:visible",!1)},r=m({file:[]}),p={file:[{required:!0,trigger:"change",message:"请上传恢复文件"}]},d=e=>!1,u=e=>{},c=(...e)=>{},x={labelCol:{span:7},wrapperCol:{span:15}},k=e=>{let a={id:i.value.start},o=new FormData;o.append("file",r.file[0].originFileObj),l({splicingData:a,data:o}).then((()=>{B.success("操作已进入任务队列, 请稍后前往青龙面板查看结果"),t("updateData"),n()}))};v(s,((e,a,l)=>{s.value&&C()}));const C=()=>{r.file=[]};return(e,l)=>{const t=w("a-button"),o=w("a-upload"),i=w("a-form-item"),f=w("a-divider"),m=w("a-form");return b(),h(a,{modalVisible:g(s),isFooter:!1,onClose:n,title:"备份恢复"},{content:_((()=>[j(m,y({ref:"formRef",name:"custom-validation",model:r,rules:p},x,{onValidate:c,onFinishFailed:u,onFinish:k}),{default:_((()=>[j(i,{label:"恢复文件",name:"file"},{default:_((()=>[j(o,{fileList:r.file,"onUpdate:fileList":l[0]||(l[0]=e=>r.file=e),"max-count":1,"before-upload":d},{default:_((()=>[j(t,null,{default:_((()=>[j(g(A)),O])),_:1})])),_:1},8,["fileList"])])),_:1}),j(f),j(i,{"wrapper-col":{span:12,offset:12},class:"timed-start-button"},{default:_((()=>[j(t,{onClick:n},{default:_((()=>[F])),_:1}),j(t,{type:"primary",style:{"margin-left":"20px"},"html-type":"submit"},{default:_((()=>[I])),_:1})])),_:1})])),_:1},16,["model"])])),_:1},8,["modalVisible"])}}},T={class:"flex form-container"},N={class:"flex-base form-container-item"},S=D("p",null,"Tip: 迁移/复制功能需要至少添加两个面板地址才能正常使用",-1),q=D("p",null,"迁移: 将A面板的所有变量迁移到B面板, 迁移完成后会清空A面板变量 ",-1),P=D("p",null,"复制: 将A面板的所有变量复制到B面板, 复制完成后A面板变量不会变化",-1),V=x("迁移"),z=x("复制"),E={class:"flex-base form-right form-container-item"},H=D("p",null,"Tip: 备份/恢复功能将会以JSON文件实现",-1),M=D("p",null,"备份: 备份完成后会自动下载备份文件，下载完成十秒后。服务器自动删除服务端备份数据",-1),J=x("备份"),R=x("恢复"),W=x("同步"),Y=D("a",{href:"https://zh.wikipedia.org/wiki/Cron",title:"参考",target:"_blank"},"?",-1),G=x("提交"),K=["innerHTML"],Q=D("p",null,"Tip: 错误日志会显示以上功能执行时发生的错误记录（只显示最新的十条记录）",-1),X={__name:"index",setup(a){const l=k(""),f=m({panel_id:[],cron:"",state:!1}),v=k([]),h=m({start:"",end:""}),g=m({type:"1"}),x=k([]),A=(e,a)=>a.label.indexOf(e)>=0,O=k(3),F=m({start:void 0,end:[]}),I=k([]),X=k([]),Z={labelCol:{span:6},wrapperCol:{span:16}},$={labelCol:{span:4},wrapperCol:{span:18}},ee=[{title:"发生时间",dataIndex:"UserID"},{title:"任务名称",dataIndex:"Username"},{title:"错误记录",dataIndex:"UserWxpusher"}],ae=k([]),le=k({}),te=k(!1),oe=e=>{X.value=x.value.filter((a=>a.value!==e)),F.end.includes(e)&&(F.end=F.end.filter((a=>a!=e)))},se=()=>{F.start?F.end.length?s({data:F}).then((()=>{F.start=void 0,F.end=[]})):B.error("请选择面板B!"):B.error("请选择面板A!")},ie=()=>{te.value=!0,le.value=g},ne=()=>{i({data:h}).then((()=>{B.success("操作已进入任务队列, 请稍后前往青龙面板查看结果!")}))},re=()=>{n({data:h}).then((()=>{B.success("操作已进入任务队列, 请稍后前往青龙面板查看结果!")}))},pe=()=>{r({data:g}).then((()=>{B.success("操作已进入任务队列, 完成后将自动下载备份文件!"),p()}))},de=()=>{d({splicingData:{type:"CronBackUpEnv"}}).then((e=>{e.cron?l.value="任务名称：CronBackUpEnv&nbsp;&nbsp;任务Corn定时："+e.cron+"&nbsp;&nbsp;任务配置："+e.config+"&nbsp;&nbsp;任务状态："+(e.status?"开启":"关闭"):l.value=""}))},ue=()=>{t().then((e=>{ae.value=e||[]}))},ce=()=>{f.panel_id.length?f.cron?c({data:f}).then((()=>{de()})):B.error("请输入cron表达式!"):B.error("请选择面板!")};return o().then((e=>{v.value=(e||[]).map((e=>({label:e.name,value:e.id}))),de()})),u({data:{},splicingData:{page:1,quantity:100}}).then((e=>{x.value=e.pageData.map((e=>({label:e.PanelName,value:e.ID,envData:e.env_data}))),h.start=x.value[0].value,g.start=x.value[0].value;try{h.end=x.value[1].value}catch(a){h.end=x.value[0].value}I.value=x.value,X.value=x.value})),(a,t)=>{const o=w("a-card"),s=w("a-select"),i=w("a-form-item"),n=w("a-col"),r=w("a-row"),p=w("a-divider"),d=w("a-button"),u=w("a-form"),c=w("a-input"),m=w("a-switch");return b(),C(U,null,[j(L,{visible:te.value,"onUpdate:visible":t[0]||(t[0]=e=>te.value=e),dataObj:le.value},null,8,["visible","dataObj"]),j(e,{isScroll:"",isNoYScroll:"",isTable:"",isNoPagination:"",columns:ee,onInitData:ue,dataSource:ae.value},{top:_((()=>[D("div",T,[D("div",N,[j(o,{title:"迁移/复制",bordered:!1},{default:_((()=>[S,q,P])),_:1}),j(u,y({model:h},Z),{default:_((()=>[j(r,null,{default:_((()=>[j(n,{span:11},{default:_((()=>[j(i,{label:"面板A:",name:"start"},{default:_((()=>[j(s,{value:h.start,"onUpdate:value":t[1]||(t[1]=e=>h.start=e),placeholder:"请选择","filter-option":A,"show-search":"","option-label-prop":"label",options:x.value},null,8,["value","options"])])),_:1})])),_:1}),j(n,{span:11},{default:_((()=>[j(i,{label:"面板B:",name:"end"},{default:_((()=>[j(s,{value:h.end,"onUpdate:value":t[2]||(t[2]=e=>h.end=e),placeholder:"请选择","filter-option":A,"show-search":"","option-label-prop":"label",options:x.value},null,8,["value","options"])])),_:1})])),_:1})])),_:1}),j(p),j(i,{"wrapper-col":{span:20,offset:2},class:"form-buttom flex"},{default:_((()=>[j(d,{type:"primary",style:{"margin-right":"20px"},class:"flex-base",onClick:ne},{default:_((()=>[V])),_:1}),j(d,{type:"primary",class:"flex-base",style:{width:"150px"},onClick:re},{default:_((()=>[z])),_:1})])),_:1})])),_:1},16,["model"])]),D("div",E,[j(o,{title:"备份/恢复",bordered:!1},{default:_((()=>[H,M])),_:1}),j(u,y({model:g},$),{default:_((()=>[j(i,{label:"操作面板:",style:{"margin-top":"46px"},name:"start"},{default:_((()=>[j(s,{value:g.start,"onUpdate:value":t[3]||(t[3]=e=>g.start=e),placeholder:"请选择","filter-option":A,"show-search":"","option-label-prop":"label",options:x.value},null,8,["value","options"])])),_:1}),j(p),j(i,{"wrapper-col":{span:20,offset:2},class:"form-buttom"},{default:_((()=>[j(d,{type:"primary",class:"flex-base",style:{"margin-right":"20px"},onClick:pe},{default:_((()=>[J])),_:1}),j(d,{type:"primary",class:"flex-base",onClick:ie},{default:_((()=>[R])),_:1})])),_:1})])),_:1},16,["model"])])]),j(o,{title:"config.sh 同步",bordered:!1},{default:_((()=>[j(r,{gutter:16},{default:_((()=>[j(n,{span:5},{default:_((()=>[j(i,{label:"面板A:",name:"start"},{default:_((()=>[j(s,{value:F.start,"onUpdate:value":t[4]||(t[4]=e=>F.start=e),placeholder:"请选择","filter-option":A,"show-search":"",onChange:oe,"option-label-prop":"label",options:I.value},null,8,["value","options"])])),_:1})])),_:1}),j(n,{span:13},{default:_((()=>[j(i,{label:"面板B:",name:"end"},{default:_((()=>[j(s,{value:F.end,"onUpdate:value":t[5]||(t[5]=e=>F.end=e),placeholder:"请选择","max-tag-count":O.value,"filter-option":A,"show-search":"",mode:"multiple","option-label-prop":"label",options:X.value},null,8,["value","max-tag-count","options"])])),_:1})])),_:1}),j(n,{span:6},{default:_((()=>[j(d,{type:"primary",style:{width:"100%"},onClick:se},{default:_((()=>[W])),_:1})])),_:1})])),_:1})])),_:1}),j(o,{title:"面板备份",bordered:!1},{default:_((()=>[j(r,{gutter:16},{default:_((()=>[j(n,{span:8},{default:_((()=>[j(i,{label:"面板:",name:"panel_id"},{default:_((()=>[j(s,{value:f.panel_id,"onUpdate:value":t[6]||(t[6]=e=>f.panel_id=e),placeholder:"请选择",mode:"multiple","filter-option":A,"show-search":"","option-label-prop":"label",options:v.value},null,8,["value","options"])])),_:1})])),_:1}),j(n,{span:7},{default:_((()=>[j(i,{label:"cron表达式:",name:"cron"},{default:_((()=>[j(c,{value:f.cron,"onUpdate:value":t[7]||(t[7]=e=>f.cron=e),placeholder:"请输入cron表达式（仅支持标准5位）"},{addonAfter:_((()=>[Y])),_:1},8,["value"])])),_:1})])),_:1}),j(n,{span:3},{default:_((()=>[j(i,{label:"启用状态:",name:"state"},{default:_((()=>[j(m,{checked:f.state,"onUpdate:checked":t[8]||(t[8]=e=>f.state=e),"checked-children":"启用","un-checked-children":"禁用"},null,8,["checked"])])),_:1})])),_:1}),j(n,{span:6},{default:_((()=>[j(d,{type:"primary",style:{width:"100%"},onClick:ce},{default:_((()=>[G])),_:1})])),_:1})])),_:1}),D("div",{innerHTML:l.value},null,8,K)])),_:1}),j(o,{title:"错误日志",bordered:!1},{default:_((()=>[Q])),_:1})])),_:1},8,["dataSource"])],64)}}};export{X as default};
