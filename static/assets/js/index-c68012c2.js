import{N as e,r as a,k as t,w as l,f as i,a4 as o,a6 as s,c as r,u as n,a8 as p,L as d,a3 as u,i as m,F as c,J as f,a2 as v}from"./@vue-11129043.js";import{p as b}from"./p-center-modal-440646c4.js";import"./dayjs-1ff0b700.js";import{a3 as y,T as j,a4 as _,a5 as g}from"./index-5b2bc764.js";import{al as h,S as x}from"./@ant-design-477981d5.js";import{m as C,F as I,E as S}from"./ant-design-vue-cc438dd6.js";import{_ as U}from"./page-container-7fa4b6af.js";import{d as w}from"./common-2c0ac4fc.js";import"./pinia-1ca0c29b.js";import"./vue-demi-a81ff0a7.js";import"./store-d3bd5447.js";import"./_plugin-vue_export-helper-9b9a8a5b.js";import"./@babel-eab0ef53.js";import"./axios-93d3568f.js";import"./qs-8fb0a9f1.js";import"./side-channel-ee547e73.js";import"./get-intrinsic-53528089.js";import"./has-symbols-1f359e75.js";import"./function-bind-c930bb92.js";import"./has-03e8e28c.js";import"./call-bind-566c57e8.js";import"./object-inspect-5c6480f3.js";import"./vue-router-36397834.js";import"./vue3-colorpicker-e1559e09.js";import"./vue-types-0fd36d85.js";import"./is-plain-object-39134198.js";import"./tinycolor2-e232e212.js";import"./@vueuse-94329f85.js";import"./@aesoper-316802a3.js";import"./vue3-angle-2884cf46.js";import"./gradient-parser-c9367eab.js";import"./lodash-es-0ceb8576.js";import"./@popperjs-31624eb1.js";import"./resize-observer-polyfill-9cd09a67.js";import"./@ctrl-16df70a4.js";import"./dom-align-6a5270eb.js";import"./async-validator-604317c1.js";import"./scroll-into-view-if-needed-8ce8502d.js";import"./compute-scroll-into-view-cce79123.js";const F=d(" 上传 "),k=d("取消"),A=d("提交"),D={__name:"editOrAdd",props:{dataObj:Object,visible:Boolean},emits:["update:visible","updateData"],setup(d,{emit:m}){const c=d,{visible:f,dataObj:v}=e(c),j=a([{value:"ordinary",label:"普通"},{value:"cron",label:"定时"}]),_=()=>{m("update:visible",!1)},g=t({type:"ordinary",file:[]}),x={type:[{required:!0,trigger:"change"}],file:[{required:!0,trigger:"change",message:"请上传插件"}]},I=e=>{g.file=[]},S=e=>(g.file=[e],!1),U=e=>{},w=(...e)=>{},D={labelCol:{span:7},wrapperCol:{span:15}},O=e=>{let a={type:g.type},t=new FormData;t.append("file",g.file[0].originFileObj),y({splicingData:a,data:t}).then((()=>{C.success("操作成功"),m("updateData"),_()}))};l(f,((e,a,t)=>{f.value&&E()}));const E=()=>{g.type="ordinary",g.file=[]};return(e,a)=>{const t=u("a-select"),l=u("a-form-item"),d=u("a-button"),m=u("a-upload"),c=u("a-divider"),v=u("a-form");return i(),o(b,{modalVisible:n(f),isFooter:!1,onClose:_,title:"上传插件"},{content:s((()=>[r(v,p({ref:"formRef",name:"custom-validation",model:g,rules:x},D,{onValidate:w,onFinishFailed:U,onFinish:O}),{default:s((()=>[r(l,{label:"类型:",name:"type"},{default:s((()=>[r(t,{value:g.type,"onUpdate:value":a[0]||(a[0]=e=>g.type=e),placeholder:"请选择",style:{width:"200px"},options:j.value},null,8,["value","options"])])),_:1}),r(l,{label:"插件",name:"file"},{default:s((()=>[r(m,{fileList:g.file,"onUpdate:fileList":a[1]||(a[1]=e=>g.file=e),"max-count":1,onRemove:I,"before-upload":S},{default:s((()=>[r(d,null,{default:s((()=>[r(n(h)),F])),_:1})])),_:1},8,["fileList"])])),_:1}),r(c),r(l,{"wrapper-col":{span:12,offset:12},class:"timed-start-button"},{default:s((()=>[r(d,{onClick:_},{default:s((()=>[k])),_:1}),r(d,{type:"primary",style:{"margin-left":"20px"},"html-type":"submit"},{default:s((()=>[A])),_:1})])),_:1})])),_:1},16,["model"])])),_:1},8,["modalVisible"])}}},O=d(" 搜索 "),E=d(" 刷新定时插件 "),L=d(" 上传插件 "),z=d(" 是否确认删除？ "),q=d("删除 "),K={__name:"index",setup(e){const l=a({}),p=a(!1),d=a({}),b=I.useForm,y=a(0),h=a(1),F=a(10);S.PRESENTED_IMAGE_SIMPLE;const k=t({type:"ordinary"});a(!1);const{resetFields:A,validate:K,validateInfos:R}=b(k),T=a([{value:"ordinary",label:"普通"},{value:"cron",label:"定时"}]),V=[{title:"文件名称",dataIndex:"file_name"},{title:"插件名称",dataIndex:"plugin_name"},{title:"操作",dataIndex:"operation",customKey:"operation"}],M=[{title:"文件名称",dataIndex:"file_name"},{title:"插件名称",dataIndex:"plugin_name"},{title:"定时时间",dataIndex:"cron_time"},{title:"执行变量名",dataIndex:"need_env_name"},{title:"操作",dataIndex:"operation",customKey:"operation"}],N=a(V),P=a([]),B=e=>{e&&(h.value=1);let a={page:h.value,quantity:F.value,type:d.value.type};"cron"==d.value.type?N.value=M:N.value=V,j({data:k,splicingData:a}).then((e=>{try{y.value=(e.page||0)*F.value}catch(a){y.value=0}P.value=(e||[]).map((e=>(e.CreatedAt&&(e.CreatedAt=w(e.CreatedAt)),e.UpdatedAt&&(e.UpdatedAt=w(e.UpdatedAt)),e)))}))};return d.value=k,(e,a)=>{const t=u("a-select"),b=u("a-form-item"),j=u("a-button"),I=u("a-form"),S=u("a-popconfirm");return i(),m(c,null,[r(D,{visible:p.value,"onUpdate:visible":a[0]||(a[0]=e=>p.value=e),onUpdateData:a[1]||(a[1]=e=>B(!0)),dataObj:l.value},null,8,["visible","dataObj"]),r(U,{columns:N.value,pageSize:F.value,"onUpdate:pageSize":a[6]||(a[6]=e=>F.value=e),current:h.value,"onUpdate:current":a[7]||(a[7]=e=>h.value=e),total:y.value,"onUpdate:total":a[8]||(a[8]=e=>y.value=e),isTable:!0,isSearch:!0,onOnShowSizeChange:B,onInitData:B,dataSource:P.value},{search:s((()=>[r(I,{class:"flex flex-warp",model:k},{default:s((()=>[r(b,{label:"类型:",name:"type"},{default:s((()=>[r(t,{value:k.type,"onUpdate:value":a[2]||(a[2]=e=>k.type=e),placeholder:"请选择",style:{width:"200px"},options:T.value},null,8,["value","options"])])),_:1}),r(b,null,{default:s((()=>[r(j,{type:"primary",onClick:a[3]||(a[3]=f((e=>{K().then((e=>{d.value=k,B(!0)})).catch((e=>{}))}),["prevent"])),class:"filter-search"},{default:s((()=>[r(n(x)),O])),_:1}),r(j,{type:"primary",style:{"margin-left":"10px"},shape:"round",onClick:a[4]||(a[4]=f((e=>{g().then((()=>{C.success("刷新成功!"),B(!0)}))}),["prevent"]))},{default:s((()=>[E])),_:1}),r(j,{type:"primary",style:{"margin-left":"10px"},shape:"round",onClick:a[5]||(a[5]=f((e=>{p.value=!0}),["prevent"]))},{default:s((()=>[L])),_:1})])),_:1})])),_:1},8,["model"])])),bodyCell:s((({text:e,record:a,index:t,column:l})=>["operation"===l.customKey?(i(),o(S,{key:0,placement:"topLeft","ok-text":"是","cancel-text":"否",onConfirm:e=>{return t=a,void _({data:{type:d.value.type,file_name:t.file_name}}).then((()=>{C.success("操作成功!"),B(!0)}));var t}},{title:s((()=>[z])),default:s((()=>[r(j,{type:"danger",style:{"margin-left":"10px","margin-bottom":"10px"},shape:"round"},{default:s((()=>[q])),_:1})])),_:2},1032,["onConfirm"])):v("",!0)])),_:1},8,["columns","pageSize","current","total","dataSource"])],64)}}};export{K as default};
